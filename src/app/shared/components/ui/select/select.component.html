<div class="app-select-wrapper">
  <!-- Label -->
  <label *ngIf="label" 
         [for]="id" 
         class="app-select-label"
         [class.app-select-label--required]="required">
    {{ label }}
  </label>


  <!-- Select container -->
  <div [class]="containerClasses" #selectContainer>
    <!-- Select button -->
    <button type="button"
            class="app-select"
            [id]="id"
            [attr.aria-label]="label"
            [disabled]="disabled"
            (click)="toggle()"
            (focus)="onTouched()"
            (blur)="onTouched()">
      <!-- Selected value display -->
      <span class="app-select-text">{{ selectedOption?.label || placeholder }}</span>
      <!-- Arrow icon -->
      <svg class="app-select-arrow" width="20" height="20" viewBox="0 0 20 20">
        <path d="M7 7l3 3 3-3" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
      <!-- Loading spinner -->
      <div *ngIf="loading" class="app-select-loading">
        <svg class="app-select-spinner" viewBox="0 0 24 24">
          <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none" opacity="0.25"></circle>
          <path fill="currentColor" opacity="0.75" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
      </div>
    </button>
  </div>

  <!-- Dropdown SIEMPRE debajo del input -->
  <div *ngIf="isOpen"
       class="app-select-dropdown"
       [class.app-select-dropdown--up]="dropdownDirection === 'up'"
       #dropdown>
    <!-- Search input -->
    <div *ngIf="searchable" class="app-select-search">
      <input type="text"
             class="app-select-search-input"
             [placeholder]="searchPlaceholder"
             [(ngModel)]="searchTerm"
             (input)="onSearch($event)"
             (click)="$event.stopPropagation()"
             #searchInput>
    </div>

    <!-- Options list -->
    <div class="app-select-options"
         [class.app-select-options--with-search]="searchable">
      <!-- Empty state -->
      <div *ngIf="filteredOptions.length === 0" class="app-select-empty">
        {{ emptyMessage }}
      </div>

      <!-- Options -->
      <ng-container *ngFor="let option of filteredOptions; trackBy: trackByValue">
        <!-- Group header -->
        <div *ngIf="option.group && !isGroupHeaderShown(option.group)"
             class="app-select-group-header">
          {{ option.group }}
        </div>

        <!-- Option item -->
        <button type="button"
                class="app-select-option"
                [class.selected]="isSelected(option)"
                [class.disabled]="option.disabled"
                [class.highlighted]="highlightedIndex === getOptionIndex(option)"
                [disabled]="option.disabled"
                (click)="selectOption(option)"
                (mouseenter)="highlightedIndex = getOptionIndex(option)">
          <!-- Option label -->
          {{ option.label }}
        </button>
      </ng-container>
    </div>
  </div>

  <!-- Error message -->
  <div *ngIf="errorMessage" class="app-select-error">
    {{ errorMessage }}
  </div>

  <!-- Hint message -->
  <div *ngIf="hint" class="app-select-hint">
    {{ hint }}
  </div>
</div>