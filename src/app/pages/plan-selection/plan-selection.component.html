<div class="plan-selection-container">
  <!-- Header -->
  <div class="plan-header">
    <div class="welcome-header">
      <h1>Selecciona tu Plan</h1>
      <p class="welcome-subtitle">Elige el plan que mejor se adapte a las necesidades de tu negocio</p>
    </div>
    <button 
      type="button" 
      class="btn-logout" 
      (click)="logout()"
      title="Cerrar sesión">
      <i class="icon-logout"></i>
      <span>Cerrar sesión</span>
    </button>
  </div>

  <!-- Plan Content -->
  <div class="plan-content">
    <!-- Loading State -->
    <div *ngIf="isLoadingPlans" class="loading-container">
      <div class="loading-spinner"></div>
      <p class="loading-text">Cargando planes disponibles...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="error && !isLoadingPlans" class="error-container">
      <div class="error-icon">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="15" y1="9" x2="9" y2="15"></line>
          <line x1="9" y1="9" x2="15" y2="15"></line>
        </svg>
      </div>
      <h3 class="error-title">Error al cargar los planes</h3>
      <p class="error-message">{{ error }}</p>
      <button class="retry-button" (click)="retryLoadPlans()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="23 4 23 10 17 10"></polyline>
          <polyline points="1 20 1 14 7 14"></polyline>
          <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"></path>
        </svg>
        Reintentar
      </button>
    </div>

    <!-- Plans Grid -->
    <div *ngIf="!isLoadingPlans && !error" class="plans-grid">
      <div
        *ngFor="let plan of plans"
        class="plan-card"
        [class.selected]="selectedPlan === plan.id"
        [class.popular]="plan.popular"
        (click)="selectPlan(plan.id)">

        <!-- Popular Badge -->
        <div *ngIf="plan.popular" class="popular-badge">
          <span>Más Popular</span>
        </div>

        <!-- Plan Header -->
        <div class="plan-header">
          <h3 class="plan-name">{{ plan.name }}</h3>
          <div class="plan-price">
            <span class="price-label">{{ plan.priceLabel }}</span>
            <span *ngIf="plan.price > 0" class="price-period">por año</span>
          </div>
          <p class="plan-invoices">{{ plan.invoicesLabel }}</p>
        </div>

        <!-- Plan Features -->
        <div class="plan-features">
          <ul>
            <li *ngFor="let feature of plan.features">
              <svg class="check-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
              </svg>
              {{ feature }}
            </li>
          </ul>
        </div>

        <!-- Selection Indicator -->
        <div class="selection-indicator" [style.background]="plan.gradient">
          <svg *ngIf="selectedPlan === plan.id" class="check-selected" width="20" height="20" viewBox="0 0 24 24" fill="white">
            <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
          </svg>
        </div>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="actions-section">
      <div class="actions-container">
        <button 
          class="skip-button"
          (click)="onSkip()"
          [disabled]="isLoading">
          Continuar con plan gratuito
        </button>
        
        <button 
          class="continue-button"
          [disabled]="!selectedPlan || isLoading"
          (click)="onContinue()">
          <span *ngIf="!isLoading">Continuar con {{ selectedPlanName }}</span>
          <div *ngIf="isLoading" class="button-spinner"></div>
        </button>
      </div>
    </div>
  </div>

  <!-- Background Elements -->
  <div class="bg-elements">
    <div class="floating-element floating-1"></div>
    <div class="floating-element floating-2"></div>
    <div class="floating-element floating-3"></div>
    <div class="floating-element floating-4"></div>
  </div>

  <!-- Alert Component -->
  <app-alert
    [message]="alertMessage"
    [type]="alertType"
    confirmTitle="Confirmar Acción"
    confirmText="Confirmar"
    cancelText="Cancelar"
    (confirmed)="onAlertConfirmed()"
    (cancelled)="onAlertCancelled()"
    (closed)="clearAlert()">
  </app-alert>
</div>
