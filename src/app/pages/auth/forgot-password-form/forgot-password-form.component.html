<!-- Alert Component -->
<app-alert
  *ngIf="showAlertComponent"
  [message]="alertMessage"
  [type]="alertType"
  [dismissible]="true"
  (closed)="onAlertClosed()">
</app-alert>

<!-- Formulario de Recuperación -->
<div *ngIf="currentStep === 'form'" class="auth-section">
  <div class="welcome-header">
    <h1>Recuperar Contraseña</h1>
    <p class="welcome-subtitle">Ingresa tu correo electrónico para recibir instrucciones de recuperación</p>
  </div>

  <form class="auth-form" (ngSubmit)="onSendRecoveryEmail()" #recoveryForm="ngForm">
    <div class="form-group">
      <label for="recoveryEmail">Correo Electrónico</label>
      <div class="input-wrapper">
        <input
          type="email"
          id="recoveryEmail"
          name="recoveryEmail"
          [(ngModel)]="recoveryEmail"
          (input)="onEmailInput()"
          (keydown.enter)="onSendRecoveryEmail()"
          placeholder="correo@empresa.com"
          class="form-input"
          required
          email
          autocomplete="email"
          #emailField="ngModel"
          [class.error]="emailField.invalid && emailField.touched"
          [class.success]="isEmailValid() && recoveryEmail.length > 0"
          [attr.aria-describedby]="emailField.invalid && emailField.touched ? 'email-error' : null"
          [attr.aria-invalid]="emailField.invalid && emailField.touched">
        <span class="input-icon">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.89 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
          </svg>
        </span>
        <div class="input-feedback" *ngIf="recoveryEmail && recoveryEmail.length > 0">
          <span class="success-check" *ngIf="isEmailValid()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
            </svg>
          </span>
        </div>
      </div>
      <div class="field-error" id="email-error" *ngIf="emailField.invalid && emailField.touched" role="alert">
        <span *ngIf="emailField.errors?.['required']">El correo electrónico es requerido</span>
        <span *ngIf="emailField.errors?.['email']">Por favor ingresa un correo válido</span>
      </div>
    </div>

    <div class="form-actions">
      <button
        type="submit"
        class="primary-button"
        [disabled]="recoveryForm.invalid || isLoading"
        [class.loading]="isLoading"
        [attr.aria-describedby]="isLoading ? 'loading-text' : null">
        <div class="button-content">
          <svg *ngIf="!isLoading" width="18" height="18" viewBox="0 0 24 24" fill="currentColor" class="button-icon">
            <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.89 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
          </svg>
          <div *ngIf="isLoading" class="button-spinner" aria-hidden="true"></div>
          <span *ngIf="!isLoading">Enviar Correo de Recuperación</span>
          <span *ngIf="isLoading" id="loading-text">Enviando instrucciones...</span>
        </div>
        <div class="button-progress" *ngIf="isLoading"></div>
      </button>
    </div>

    <div class="form-footer">
      <button type="button" class="link-button" (click)="goToLogin()">
        ← Volver al inicio de sesión
      </button>
    </div>
  </form>
</div>

<!-- Mensaje de éxito del envío -->
<div *ngIf="currentStep === 'success'" class="success-message login-success">
  <div class="success-icon">
    <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor">
      <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.89 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
    </svg>
  </div>
  <h3>¡Correo Enviado!</h3>
  <p>Se han enviado las instrucciones de recuperación a tu correo electrónico.</p>
  <div class="loading-bar">
    <div class="progress"></div>
  </div>
</div>